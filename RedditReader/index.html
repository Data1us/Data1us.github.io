
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>My Reddit Rss Reader</title>

    <!-- Bootstrap core CSS -->
    <link href="./styles/bootstrap.min.css" rel="stylesheet">
    <link href="./styles/sb-admin-2.css" rel="stylesheet">  	
	<link rel="stylesheet" href="./styles/blueimp-gallery.min.css">	
	<link href="./styles/metisMenu.min.css" rel="stylesheet">
      <link href="./styles/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="./styles/site.css" rel="stylesheet" type="text/css">
	
  </head>

  <body>	
  
  
<div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-fixed-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html"><span class="blue">Reddit</span>Reader</a>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right">
                                                        
            </ul>
            <!-- /.navbar-top-links -->

            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse" aria-expanded="false" style="height: 1px;">
                    <ul class="nav in" id="side-menu">
                        <li class="sidebar-search">
                            <div class="input-group custom-search-form">
                                <input type="text" class="form-control" placeholder="Search..." id="SubreditSearch">
                                <span class="input-group-btn">
                                <button class="btn btn-default" type="button" id="SubreditSearchBtn">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                            </div>
                            <!-- /input-group -->
                        </li>  
						<li>
							<div id="display-mode" class="btn-group">
								<a class="btn btn-default active" rel="text" aria-label="Left Align">Text</a>
								<a class="btn btn-default" rel="image" aria-label="Center Align">Image</a>					
							</div>			
						</li>
						
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper" style="min-height: 330px; margin-top:50px;">
            
            
			<!-- container for the image -->
			<div id="image-section" class="display-none">
				<div id="links" class="row"></div>
				<a id="image-more" class="btn btn-primary" > more</a>
			</div>
			<div id="text-section" class="">
				<div id="reader-content"></div>
				<div id="loaderrrr">x</div>
			</div>

			<!-- The Bootstrap Image Gallery lightbox, should be a child element of the document body -->
			<div id="blueimp-gallery" class="blueimp-gallery">
				<!-- The container for the modal slides -->
				<div class="slides"></div>
				<!-- Controls for the borderless lightbox -->
				<h3 class="title"></h3>
				<a class="prev">‹</a>
				<a class="next">›</a>
				<a class="close">×</a>
				<a class="play-pause"></a>
				<ol class="indicator"></ol>
				<!-- The modal dialog, which will be used to wrap the lightbox content -->
				<div class="modal fade">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" aria-hidden="true">&times;</button>
								<h4 class="modal-title"></h4>
							</div>
							<div class="modal-body next"></div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default pull-left prev">
									<i class="glyphicon glyphicon-chevron-left"></i>
									Previous
								</button>
								<button type="button" class="btn btn-primary next">
									Next
									<i class="glyphicon glyphicon-chevron-right"></i>
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>


          
          <style> #loader { width: 500px;margin: auto;height: 200px;display: none;} </style>
          <div id="loader">
          <img src="./Content/loading.gif" class="img-circle"/>
          </div>            
            
            
          
        </div>
        

		
		
    </div>  

    <!-- JavaScript -->

    <script src="./scripts/jquery-1.11.0.min.js"></script>
    <script src="./scripts/handlebars-v4.0.5.js"></script>
    <script src="./scripts/underscore-min.js"></script>
    <script src="./scripts/bootstrap.min.js"></script>
	<script src="./scripts/jquery.blueimp-gallery.min.js"></script>
	<script src="./scripts/metisMenu.min.js"></script>
	<script src="./scripts/sb-admin-2.js"></script>
    <script src="./scripts/fitonscreen.js"></script>
    <script src="./scripts/sitemain.js"></script>
    <script src="./scripts/Templates/SiteTemplates.js"></script>
      <script src="./scripts/RedditView.js"></script>
      <script src="./scripts/RedditImageView.js"></script>
      <script src="./scripts/RedditDataProvider.js"></script>
      <script src="./scripts/RedditTextScreen.js"></script>

	
    
    <script>
		
	
        var leftMenu = $("#side-menu");
        
        var content = $("#reader-content");
		var links = $("#links");
        
		var imageMode = function(){
			return $("#display-mode a.active").prop("rel") === "image";
		};
		
		
		var loading = true;
        var readers = [
			{ Name: "UT4", Location: "unrealtournament" },
			{ Name: "Warframe", Location: "warframe" },
			{ Name: "Protoss", Location: "allthingsprotoss" },
            { Name: "Snowboarding", Location: "snowboarding" },		
			{ Name: "Freediving", Location: "freediving" },
            { Name: "Surfing", Location: "surfing" },
            { Name: "Stand Up Paddle", Location: "sup" },
            { type: "hot", Name: "Pics", Location: "pics" },
            { Name: "Hockey", Location: "fieldhockey" },
            { Name: "Freeboard", Location: "freebord" },
            { Name: "Wakeboarding", Location: "wake" },
            { Name: "Kiteboarding", Location: "Kiteboarding" },
            { Name: "Longboarding", Location: "longboarding" }            
        ];

        var screens = {
            "RedditTextScreen": page.RedditTextScreen
        };
        var readersNew = [
            { Name: "Overwatch", Location: "overwatch", Screen: "RedditTextScreen", type: "new" },
            { Name: "Sprinting", Location: "sprinting", Screen: "RedditTextScreen", type: "new" }
        ];

        var menuMarkup =
            _.each(readers, function(reader) {
                leftMenu.append(page.templates.LeftMenuItem(reader).replace(/\ufeff/, ''));
            });				
                
        _.each(readersNew, function (reader) {
            leftMenu.append(page.templates.LeftMenuItemNew(reader).replace(/\ufeff/, ''));
        });
		
		var scrollToTop = function() {
			//$("html, body").animate({ scrollTop: 0 }, "fast");	
			window.scrollTo(0,0);
		};
		
		var setHash = function(name) {
			if (_.isUndefined(window.location.hash)) return;
			window.location.hash = name;
		}
		
		var getHash = function() {
			if (_.isUndefined(window.location.hash)) return;
			return window.location.hash;
		}
		
		var isImage = function(input){
			if (input.indexOf(".jpg") > 0) return true;
			if (input.indexOf(".gif") > 0 && input.indexOf(".gifv") == -1) return true;
			return false;
		};
		
		var getThumbnail = function(input) {
			if (input.indexOf("nsfw") > -1) return "/Content/nsfw.png";
			return input;
		}
		
		var renderItems = function(json){
			loading=true;
			var data = json.data;
			if (!_.isUndefined(data) && !_.isUndefined(data.children)) {			
			    if (!imageMode()) {
			        var x = new page.RedditView({ target: content });
			        x.render(data);			        
				}
				else {			
				    var x = new page.RedditImageView({ target: links });
				    x.render(data);				   
			    }
			    $("#loader").hide();
			}		
			
			//scrollToTop();
		};		
		
		var activate = function(item) {			
			deactivateAll();
			item.addClass("IsActive");			
		}
		
		var deactivateAll = function() {
			$("a.IsActive").removeClass("IsActive");
		};
		
        $(".left-menu-item").click(function(e) {
			$(".navbar-header button").click();
            e.preventDefault();
			loading = true;
            content.html("");
			links.html("");
            $("#loader").show();
            var item = $(this),
                rel = item.attr("rel"),
				name = item.find("span").html();
			setHash(name);
			
			activate(item);
			$("#SubreditSearch").val("");
			
            performSubreditSearch(rel);
        });

        var currentScreen = undefined;

        $(".left-menu-item-new").click(function (e) {
            e.preventDefault();
            var item = $(this);
            var screen = item.attr("data-screen");
            var name = item.attr("data-name");
            var location = item.attr("data-location");
            var type = item.attr("data-type");

            //if we have a screen running lets clear it.
            if (typeof (currentScreen) !== "undefined") currentScreen.dispose();

            content.html(""); links.html(""); //Legacy rubish for the time being.
           
            var scr = new screens[screen]({
                target: content,
                name: name,
                itemType: type
            });
            currentScreen = scr;
            scr.render();
        });
		
		var performSubreditSearch = function(name, after, clearContent, scrollTop){
			if (_.isUndefined(clearContent)) clearContent = true;			
			if (clearContent) content.html("");
			if (_.isUndefined(scrollTop)) scrollTop = true;			
			
			var matching = _.filter(readers, function(obj) {    
				return obj.Location.toLowerCase() === name.toLowerCase();
			});
			
			var itemType = "new";
			if (matching.length > 0) {
				var reader = matching[0];
				itemType = typeof(reader.type) != "undefined" ? reader.type : "new"
			}
			
            $("#loader").show();						
			var lastItem = $(".reddit-item").last();
			var limit=(imageMode()) ? 100 : 25;								
			setHash(name);
			
			var dp = new page.RedditDataProvider();
			dp.get(name, itemType, limit, after, function (json) {
			    renderItems(json);			   
			    loading = false;
			    if (scrollTop) scrollToTop();
			});
		};
		
		
		var initSearch = function() {			
			$(".navbar-header button").click();
			var name = $("#SubreditSearch").val();
			deactivateAll();
			
			if (imageMode()){			
				links.html("");
				performSubreditSearch(name);				
			}
			else {
				setHash(name);
				content.html("");	
			}
		};
		
		$("#SubreditSearch").keyup(function(e){
			var keycode = (e.keyCode ? e.keyCode : e.which);
			if(keycode != '13') return;
			initSearch();
		});
		
		$("#SubreditSearchBtn").click(function(e){
			e.preventDefault();
			initSearch();
		});
		
		$("#image-more").click(function(e){
			e.preventDefault();
			var hash = getHash().replace("#","");
			var lastItem = $("#links a.reddit-image-link").last().prop("rel");
			performSubreditSearch(hash, lastItem, false, false);			
		});	
		
		
		$("#display-mode a").click(function(e){
			e.preventDefault();
			$(".navbar-header button").click();
			$("#display-mode a.active").removeClass("active");
			$(this).addClass("active");
			var hash = getHash().replace("#","");
			if (imageMode()){	
				$("#image-section").removeClass("display-none");
				$("#text-section").addClass("display-none");						
				links.html("");
				performSubreditSearch(hash);				
			}
			else {								
				content.html("");	
				$("#image-section").addClass("display-none");
				$("#text-section").removeClass("display-none");										
			}			
		});
		
		
		var doLoad = $("#loaderrrr");
		setInterval(function(e){
			if (doLoad.isOnScreen() && !loading) {
				loading=true;				
				var hash = getHash().replace("#","");
				var lastItem = $(".reddit-item").last().find("input").val();
				performSubreditSearch(hash, lastItem, false, false);
			}
		},50);
		
		//render the current reddit.
		var hash = getHash();
		if (!_.isUndefined(hash)){
			var item = $(hash);
			if (item.length > 0) item.click();
			else {
				performSubreditSearch(hash.replace("#", ""), undefined, undefined);
				$("#SubreditSearch").val(hash.replace("#", ""));				
			}
		}	
		
		

    </script>        
    

      

  </body>
</html>